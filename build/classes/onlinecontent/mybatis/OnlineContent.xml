<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> -->
<mapper namespace="onlinecontent.mybatis.OnlineContent">
	<select id="getContent" parameterType="int" resultType="AttachFileVideoDTO">
		select * from WN_VIDEO where mnum=#{mnum}
	</select> 
		<insert id="insertContent_videoOk" parameterType="map">
		insert all
		into WN_ONLINE values (wn_oncontent_seq.nextval,#{oc_dto.ctnum},#{oc_dto.mnum},#{oc_dto.title},
			#{oc_dto.content},#{oc_dto.price},wn_photo_seq.nextval,wn_video_seq.nextval)
		into WN_PHOTO values (wn_photo_seq.currval,#{p_dto.mnum},#{p_dto.filename},#{p_dto.fileext},#{p_dto.filedir})
		into WN_VIDEO values (wn_video_seq.currval,#{v_dto.mnum},#{v_dto.filename},#{v_dto.filedir})
	    select * from dual
	</insert>
	<insert id="insertContent_videoNo" parameterType="map">
		insert all
		into WN_ONLINE values (wn_oncontent_seq.nextval,#{oc_dto.ctnum},#{oc_dto.mnum},#{oc_dto.title},
			#{oc_dto.content},#{oc_dto.price},wn_photo_seq.nextval,wn_video_seq.nextval)
		into WN_PHOTO values (wn_photo_seq.currval,#{p_dto.mnum},#{p_dto.filename},#{p_dto.fileext},#{p_dto.filedir})
	    select * from dual
	</insert>
	<select id="listContent" parameterType="int" resultType="map">
	select WN_online.*, WN_PHOTO.FILENAME, WN_PHOTO.FILEDIR, WN_PHOTO.FILEEXT, WN_MEMBER.NAME from WN_ONLINE, WN_PHOTO, WN_MEMBER where WN_ONLINE.PTNUM = WN_PHOTO.PTNUM and WN_ONLINE.CTNUM = #{ctnum} and WN_MEMBER.MNUM = WN_PHOTO.MNUM
	</select>
	 <select id="recommendContent" parameterType="int" resultType="map">
		select * from (select * from (select  WN_ONLINE.*, WN_MEMBER.NAME , WN_PHOTO.FILEDIR, WN_PHOTO.FILENAME, WN_PHOTO.FILEEXT from WN_MEMBER, WN_CATEGORY, WN_ONLINE, WN_PHOTO where WN_MEMBER.INTEREST = WN_CATEGORY.NAME and WN_MEMBER.MNUM = #{mnum} and WN_ONLINE.CTNUM = WN_CATEGORY.CTNUM and WN_ONLINE.PTNUM = WN_PHOTO.PTNUM ) ORDER BY DBMS_RANDOM.VALUE ) where rownum <![CDATA[<=]]> 10
	</select> 
</mapper> 